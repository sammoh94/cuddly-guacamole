import osimport jsonfrom pathlib import Pathimport face_recognition as frimport spotipyfrom spotipy.oauth2 import SpotifyOAuthdef buildDatabase(cid, secret, redURI = 'https://www.google.com', scopes = 'streaming, user-read-playback-state, user-modify-playback-state', dirName = './known_people', encFile = 'encodings.json'):    '''    Summary    -------    Checks if the proper files and directories are present in the main project    directory and creates them if they are not. Maps a person's name to facial    encodings found in a provided image (from the known_people directory) using    the face_recognition API and to Spotify track URIs from the user's input.    Dumps this mapping to a JSON file.    Parameters    ----------    cid : string, required        Represents the Spotify app's client_id. You will get this by creating an        authorized Spotify Developer App    secret : string, required        Represents the Spotify app's secret id. You will get this by creating an        authorized Spotify Developer App (DO NOT SHARE WITH OTHERS)    redURI : string, optional        Redirect URI. You must confirm that you are redirected to the correct        URI on first run of script. The default value is https://www.google.com;        however, this will vary based on the credentials of your own app. You will        have to make sure that whatever URI you use here is also added to your        app in the Spotify Developer Dashboard.    scopes : string, optional        The scopes represent what functionalities we can access.        The scopes 'streaming, user-read-playback-state, user-modify-playback-state'        allow us to playback music and acquire the device id from which we want        to do that playback. Can add additional scopes for additional functionality    dirName : string, optional        Directory name. This is the directory in which you will store photographs        to train the facial recognition model. All files in this directory should        be of the form '[FIRST NAME] [LAST NAME].jpg'. The default is './known_people'.    encFile : string, optional        Encodings file. This is a json file that maps a person's name to their        facial features and favorite song. The default is 'encodings.json'.    Returns    -------    None.    '''        if not os.path.isdir(dirName):        os.mkdir(dirName)        with open('.gitignore', 'a+') as gi:            gi.write(f'\n{dirName}')        if not os.path.isfile(encFile):        with open(encFile, 'w'):            pass        with open('.gitignore', 'a+') as gi:            gi.write(f'\n{encFile}')                      with open(encFile, 'r') as enc:        try:            identityMap = json.loads(enc.read())        except:            identityMap = {}            sp = spotipy.Spotify(auth_manager = SpotifyOAuth(client_id = cid, client_secret = secret, redirect_uri = redURI, scope = scopes))    #TODO clean this block of code up    for filename in os.listdir(dirName):        if filename.endswith('.jpg'):            name = Path(f'./{filename}').stem            if name not in identityMap.keys():                image = fr.load_image_file(os.path.join(dirName, filename))                faceEnc = fr.face_encodings(image)[0]                while True:                    try:                        track = input(f"Enter {name}'s favorite song: ")                        artist = input(f"Enter artist of {name}'s favorite song: ")                        searchQuery = f'{track} {artist}'                        searchResults = sp.search(q=searchQuery, limit = 1)                        trackURI = searchResults['tracks']['items'][0]['uri']                        identityMap[name] = [faceEnc.tolist(), trackURI]                        break                    except:                        print('Not a valid Song/Artist Combo. Please try again.')                                            with open(encFile, 'w') as enc:        json.dump(identityMap, enc, indent = 2)        def updateFavoriteSong(names, cid, secret, redURI = 'https://www.google.com', scopes = 'streaming, user-read-playback-state, user-modify-playback-state', encFile = 'encodings.json'):    '''    Summary    -------    Takes in a list of names for which the user wishes to change the mapped    favorite song. Checks if name is valid, and if so allows the user to input    new song information. Dumps new mapping to a JSON file.    Parameters    ----------    names : list, required        List of names for which the user wishes to change favorite song    secret : string, required        Represents the Spotify app's secret id. You will get this by creating an        authorized Spotify Developer App (DO NOT SHARE WITH OTHERS)    redURI : string, optional        Redirect URI. You must confirm that you are redirected to the correct        URI on first run of script. The default value is https://www.google.com;        however, this will vary based on the credentials of your own app. You will        have to make sure that whatever URI you use here is also added to your        app in the Spotify Developer Dashboard.    scopes : string, optional        The scopes represent what functionalities we can access.        The scopes 'streaming, user-read-playback-state, user-modify-playback-state'        allow us to playback music and acquire the device id from which we want        to do that playback. Can add additional scopes for additional functionality    encFile : string, optional        Encodings file. This is a json file that maps a person's name to their        facial features and favorite song. The default is 'encodings.json'.    Returns    -------    None.    '''    with open(encFile, 'r') as enc:        try:            identityMap = json.loads(enc.read())        except:            identityMap = {}        sp = spotipy.Spotify(auth_manager = SpotifyOAuth(client_id = cid, client_secret = secret, redirect_uri = redURI, scope = scopes))        for name in names:        if name not in identityMap.keys():            print(f'\n{name} does not have data stored. Check spelling or update database.')            continue        while True:            try:                track = input(f"Enter {name}'s favorite song: ")                artist = input(f"Enter artist of {name}'s favorite song: ")                searchQuery = f'{track} {artist}'                searchResults = sp.search(q=searchQuery, limit = 1)                trackURI = searchResults['tracks']['items'][0]['uri']                identityMap[name][1] = trackURI                break            except:                print('Not a valid Song/Artist Combo. Please try again.')                    with open(encFile, 'w') as enc:        json.dump(identityMap, enc, indent = 2)keyFile = 'keys.txt'if not os.path.isfile(keyFile):    with open(keyFile, 'w') as kf:        pass    with open('.gitignore', 'a+') as gi:        gi.write(f'\n{keyFile}')else:            with open(keyFile, 'r') as keys:        cid, secret = keys.read().split('\n')            buildDatabase(cid, secret)        